<!DOCTYPE html>
<html>
<head>
	<title>Lista do Firebase</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
		}

		h1, h2, h3 {
			background-color: #333;
			height: auto;
			max-height: 150px;
			width: auto;
			max-width: 350px;
			color: #fff;
			padding: 10px;
			margin: 0;
		}

		#emprestimo, #todevendo, #medeve {
			height: auto;
			max-height: 150px;
			width: auto;
			max-width: 350px;
			overflow-y: auto;
			padding: 0;
			margin: 0;
			list-style: none;
		}

		#emprestimo li, #todevendo li, #medeve li {
			padding: 10px;
			border-bottom: 1px solid #ccc;
			cursor: pointer;
		}
	</style>
</head>
<body>
  <h1>Selecione o username<br>para emprestar dinheiro</h1>
  <ul id="emprestimo"></ul>

  <h2>Username de quem esta<br>te devendo dinheiro</h2>
  <ul id="todevendo"></ul>

  <h3>Username de quem vc esta<br>devendo dinheiro</h3>
  <ul id="medeve"></ul>

  <!-- Inclui o SDK do Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
  <script src="js/firebase.js"></script>

 <script>
// Obtém uma referência para o nó "users" do banco de dados
firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    const currentUserUid = user.uid;

// Obtém uma referência para o nó "todevendo" da lista
const todevendoRef = usersRef.child(currentUserUid).child('receber');

// 1. Obter uma referência para o nó do Firebase que contém as informações sobre os usuários que precisam receber empréstimos.
const listaEmprestimoRef = firebase.database().ref('users');

// 2. Adicionar um listener para essa referência, de modo que você possa ser notificado sempre que houver uma alteração nos dados.
listaEmprestimoRef.on('value', function(snapshot) {
  // 3. Percorrer os dados obtidos e exibir as informações dos usuários na lista correspondente.
  const emprestimoList = document.getElementById('emprestimo');
  emprestimoList.innerHTML = '';
  snapshot.forEach(function(childSnapshot) {
    const childData = childSnapshot.val();
    const receber = childData.receber;
    if (receber && receber.aceita === false && receber.uid === '') {
      const listItem = document.createElement('li');
      listItem.innerText = childData.username + ': ' + receber.valor;
      emprestimoList.appendChild(listItem);
      
      // 4. Adicionar um listener para o clique em um nome de usuário na lista, de modo que você possa atualizar o status de aceitação do empréstimo e o UID do usuário que fez a oferta de empréstimo.
      listItem.addEventListener('click', function() {
        receber.aceita = true;
        receber.uid = firebase.auth().currentUser.uid;
        childSnapshot.ref.update({receber: receber});
      });
    }
  });
});

// Cria um listener para detectar mudanças na lista "todevendo"
todevendoRef.on('value', (snapshot) => {
  // Remove todos os elementos da lista "todevendo"
  const todevendoList = document.getElementById('todevendo');
  todevendoList.innerHTML = '';

  // Obtém todos os usuários que devem dinheiro ao usuário logado
  const users = snapshot.val() || {};

  // Cria elementos de lista para cada usuário e adiciona-os à lista "todevendo"
  for (const userUid in users) {
    const user = users[userUid];
    if (user.uid) {
      const li = document.createElement('li');
      li.textContent = user.username;
      li.addEventListener('click', () => {
        alert(`${user.username} está te devendo R$${user.valor}`);
      });
      todevendoList.appendChild(li);
    }
  }
});
	  // Obtém o UID do usuário atualmente autenticado
var user = firebase.auth().currentUser;
var uid = user.uid;

// Obtém uma referência para o nó do usuário atualmente autenticado
var userRef = firebase.database().ref('users/' + uid);

// Obtém uma referência para o nó "receber" dentro do nó do usuário atualmente autenticado
var receberRef = userRef.child('receber');

// Adiciona um ouvinte para detectar alterações no nó "receber"
receberRef.on('value', function(snapshot) {
  // Limpa a lista de dívidas
  var medeveList = document.getElementById('medeve');
  medeveList.innerHTML = '';

  // Itera sobre cada filho do nó "receber"
  snapshot.forEach(function(childSnapshot) {
    // Obtém os valores dos campos "uid", "username" e "valor"
    var childData = childSnapshot.val();
    var childUid = childData.uid;
    var childUsername = childData.username;
    var childValor = childData.valor;

    // Verifica se o valor do campo "uid" é igual ao UID do usuário atualmente autenticado
    if (childUid === uid) {
      // Adiciona o nome de usuário e o valor da dívida à lista de dívidas
      var listItem = document.createElement('li');
      listItem.textContent = childUsername + ' - R$' + childValor;
      listItem.addEventListener('click', function() {
        // Exibe um alerta com o nome de usuário do usuário devedor
        alert(childUsername);
      });
      medeveList.appendChild(listItem);
    }
  });
});

	  
} else {
    // usuário não autenticado, redirecionar para página de login ou fazer outra ação
  }
});
  </script>
</body>
</html>
