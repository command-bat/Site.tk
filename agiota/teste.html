<!DOCTYPE html>
<html>
<head>
	<title>Lista de Usernames do Firebase</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
		}

		h1 {
			background-color: #333;
			height: auto;
			max-height: 150px;
			width: auto;
			max-width: 350px;
			color: #fff;
			padding: 10px;
			margin: 0;
		}

		#usernames {
			height: auto;
			max-height: 150px;
			width: auto;
			max-width: 350px;
			overflow-y: auto;
			padding: 0;
			margin: 0;
			list-style: none;
		}

		#usernames li {
			padding: 10px;
			border-bottom: 1px solid #ccc;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<h1>Selecione o username<br>para emprestar dinheiro</h1>
	<ul id="usernames"></ul>

	<!-- Inclui o SDK do Firebase -->
	<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
        <script src="js/firebase.js"></script>

	<script>

		// Referência do banco de dados
		var usersRef = firebase.database().ref('users');

		// Consulta os usuários e exibe na lista
		usersRef.orderByChild('username').once('value', function(snapshot) {
			var usernames = document.getElementById("usernames");
			snapshot.forEach(function(childSnapshot) {
				var username = childSnapshot.child('username').val();
				var recVal = childSnapshot.child('inf/receber/valor').val();
				var listItem = document.createElement("li");
				listItem.innerHTML = username + "|" + recVal;
				usernames.appendChild(listItem);
			});
			// Define a altura da lista de usuários com base na quantidade de itens
			if (usernames.children.length > 5) {
				usernames.style.height = "200px";
				usernames.style.overflow = "auto";
			}
		});

		// Verifica se o usuário está logado e exibe o valor a receber ao clicar na lista
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				var userId = user.uid;
				var userRef = firebase.database().ref('users/' + userId + '/inf/receber/valor');
				var listItem = document.createElement("li");
				listItem.addEventListener('click', function() {
					userRef.once('value').then(function(snapshot) {
						var recVal = snapshot.val();
						alert(recVal);
					}).catch(function(error) {
						console.log(error);
					});
				});
			}
		});
	</script>
</body>
</html>
