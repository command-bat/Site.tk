<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>QR Code Pix</title>
    <script src="https://cdn.rawgit.com/LazarSoft/jsqrcode/master/src/qr_packed.js"></script>
  </head>
  <body>
    <div id="qrcode"></div>
<p id="code"></p>
    <script>
      function generatePixQRCode() {
        // Chave Pix
        var chavePix = "44395052878";

        // Nome do titular da conta
        var nomeTitular = "TIAGO N LAUREANO";

        // Cidade do titular da conta
        var cidadeTitular = "GUAPIACU";

        // Valor da transação em centavos
        var valorTransacao = "10";

        // Identificador único da transação
        var idTransacao = generateTransactionId();

        // Constrói a string com os dados do Pix
        var pixData = "000201" +
                      "26370014" + "br.gov.bcb.pix" + chavePix.length.toString().padStart(2, "0") + chavePix +
                      "52040000" + "001" +
                      "5303986" + nomeTitular.length.toString().padStart(2, "0") + nomeTitular +
                      "5802" + cidadeTitular.length.toString().padStart(2, "0") + cidadeTitular +
                      "5405100" + valorTransacao.length.toString().padStart(2, "0") + valorTransacao +
                      "58012" + idTransacao.length.toString().padStart(2, "0") + idTransacao +
                      "6304";

        // Calcula o CRC16 dos dados do Pix
        var crc16 = crc16ccitt(pixData);

        // Adiciona o CRC16 aos dados do Pix
        pixData += crc16;
var codeid = document.getElementById("code");
codeid.innerHTML = pixData;
alert(pixData);

        // Gera o QR Code a partir dos dados do Pix
        var qrCode = new QRCode(document.getElementById("qrcode"), {
          text: pixData,
          width: 256,
          height: 256,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      }

      // Função para calcular o CRC16 dos dados do Pix
      function crc16ccitt(data) {
        var crc = 0xFFFF;
        for (var i = 0; i < data.length; i++) {
          crc ^= data.charCodeAt(i) << 8;
          for (var j = 0; j < 8; j++) {
            if ((crc & 0x8000) != 0) {
              crc = (crc << 1) ^ 0x1021;
            } else {
              crc <<= 1;
            }
          }
        }
        return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, "0");
      }

function generateTransactionId() {
  // Gera um número randômico entre 0 e 99999
  var randomNumber = Math.floor(Math.random() * 100000);

  // Obtém a data e hora atual
  var date = new Date();
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString().padStart(2, "0");
  var day = date.getDate().toString().padStart(2, "0");
  var hours = date.getHours().toString().padStart(2, "0");
  var minutes = date.getMinutes().toString().padStart(2, "0");
  var seconds = date.getSeconds().toString().padStart(2, "0");

  // Concatena as informações para gerar o identificador único
  var transactionId = year + month + day + hours + minutes + seconds + randomNumber.toString().padStart(5, "0");

  return transactionId;
}


      // Gera o QR Code quando a página carrega
      window.onload = generatePixQRCode;
    </script>
  </body>
</html>
